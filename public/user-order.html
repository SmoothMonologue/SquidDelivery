<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주문하기</title>
    <style>
        .restaurant-item { margin: 10px; padding: 10px; border: 1px solid #ddd; }
        .menu-item { margin: 5px 0; }
        .cart-item { margin: 5px 0; background: #f5f5f5; padding: 5px; }
    </style>
</head>
<body>
    <h1>음식 주문</h1>

    <!-- 레스토랑 목록 -->
    <div class="section">
        <h2>레스토랑 목록</h2>
        <div id="restaurantList"></div>
    </div>

    <!-- 장바구니 -->
    <div class="section">
        <h2>장바구니</h2>
        <div id="cart"></div>
        <button onclick="placeOrder()">주문하기</button>
    </div>

    <!-- 주문 현황 -->
    <div class="section">
        <h2>주문 현황</h2>
        <div id="orderStatus"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const token = localStorage.getItem('accessToken');
        const socket = io();

        // 초기화
        async function initialize() {
            try {
                const response = await fetch('/api/user/info', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const userData = await response.json();
                
                socket.emit('register', { 
                    role: 'user', 
                    userId: userData.id 
                });

                loadRestaurants();
                loadCart();
                loadCurrentOrder();
            } catch (error) {
                console.error('초기화 실패:', error);
            }
        }

        // 레스토랑 목록 로드
        async function loadRestaurants() {
            try {
                const response = await fetch('/api/restaurants', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const restaurants = await response.json();
                
                document.getElementById('restaurantList').innerHTML = restaurants.map(restaurant => `
                    <div class="restaurant-item">
                        <h3>${restaurant.restaurantName}</h3>
                        <p>평점: ${restaurant.starRating}점</p>
                        <button onclick="showMenu(${restaurant.id})">메뉴 보기</button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('레스토랑 로드 실패:', error);
            }
        }

        // 주문 상태 업데이트 수신
        socket.on('status_update', (data) => {
            document.getElementById('orderStatus').innerHTML = `
                <p>주문 상태: ${data.status}</p>
            `;
        });

        // 페이지 로드 시 초기화
        initialize();
    </script>
</body>
</html> 