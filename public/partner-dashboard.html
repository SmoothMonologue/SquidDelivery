<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사장님 대시보드</title>
    <style>
        .section { margin: 20px; padding: 20px; border: 1px solid #ddd; }
        .order-item { margin: 10px 0; padding: 10px; background: #f5f5f5; }
        .menu-item { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>사장님 대시보드</h1>
    
    <!-- 주문 관리 섹션 -->
    <div class="section">
        <h2>실시간 주문 현황</h2>
        <div id="orderList"></div>
    </div>

    <!-- 메뉴 관리 섹션 -->
    <div class="section">
        <h2>메뉴 관리</h2>
        <form id="menuForm">
            <input type="text" id="menuName" placeholder="메뉴명" required>
            <input type="number" id="price" placeholder="가격" required>
            <input type="number" id="spicyLevel" placeholder="맵기 정도 (1-5)" min="1" max="5">
            <button type="submit">메뉴 추가</button>
        </form>
        <div id="menuList"></div>
    </div>

    <!-- 리뷰 관리 섹션 -->
    <div class="section">
        <h2>리뷰 관리</h2>
        <div id="reviewList"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const token = localStorage.getItem('accessToken');
        const socket = io();

        // 소켓 연결 및 초기화
        async function initialize() {
            try {
                const response = await fetch('/api/partner/info', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const partnerData = await response.json();
                
                socket.emit('register', { 
                    role: 'partner', 
                    partnerId: partnerData.id 
                });

                loadOrders();
                loadMenus();
                loadReviews();
            } catch (error) {
                console.error('초기화 실패:', error);
            }
        }

        // 주문 목록 로드
        async function loadOrders() {
            try {
                const response = await fetch('/api/partner/orders', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const orders = await response.json();
                
                const orderList = document.getElementById('orderList');
                orderList.innerHTML = orders.map(order => `
                    <div class="order-item">
                        <p>주문번호: ${order.id}</p>
                        <p>상태: ${order.status}</p>
                        <p>금액: ${order.priceSum}원</p>
                        <button onclick="updateOrderStatus(${order.id}, '조리중')">조리 시작</button>
                        <button onclick="updateOrderStatus(${order.id}, '배달중')">배달 시작</button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('주문 로드 실패:', error);
            }
        }

        // 주문 상태 업데이트
        async function updateOrderStatus(orderId, status) {
            try {
                await fetch(`/api/partner/orders/${orderId}/status`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status })
                });
                
                socket.emit('status_update', { orderId, status });
                loadOrders();
            } catch (error) {
                console.error('상태 업데이트 실패:', error);
            }
        }

        // 페이지 로드 시 초기화
        initialize();
    </script>
</body>
</html> 