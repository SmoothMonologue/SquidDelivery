<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>결제</title>
</head>

<body>
    <h1>결제</h1>
    <div id="orderSummary"></div>

    <form id="paymentForm">
        <label for="paymentMethod">결제 방식:</label>
        <select id="paymentMethod" name="paymentMethod" required>
            <option value="card">카드 결제</option>
            <option value="transfer">계좌 이체</option>
        </select><br>

        <button type="submit">결제하기</button>
    </form>

    <script>
        const CART_API_URL = 'http://localhost:3001/api/cart';
        const PAYMENT_API_URL = 'http://localhost:3001/api/payment';

        const loadOrderSummary = async () => {
            try {
                const response = await fetch(CART_API_URL, {
                    headers: { Authorization: `Bearer ${localStorage.getItem('accessToken')}` },
                });

                if (!response.ok) throw new Error('장바구니를 불러올 수 없습니다.');

                const cart = await response.json();
                const summary = cart.map(item => `
                    <p>${item.menuName} x ${item.quantity} = ${item.price * item.quantity}원</p>
                `).join('');

                document.getElementById('orderSummary').innerHTML = summary + `<p>총 금액: ${cart.reduce((total, item) => total + item.price * item.quantity, 0)}원</p>`;
            } catch (error) {
                console.error(error);
                alert('결제 정보를 불러오는 중 문제가 발생했습니다.');
            }
        };

        document.getElementById('paymentForm').onsubmit = async (e) => {
            e.preventDefault();

            const paymentMethod = document.getElementById('paymentMethod').value;

            try {
                const response = await fetch(PAYMENT_API_URL, {
                    method: 'POST',
                    headers: {
                        Authorization: `Bearer ${localStorage.getItem('accessToken')}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ paymentMethod }),
                });

                if (!response.ok) throw new Error('결제 실패');

                alert('결제가 완료되었습니다!');
                window.location.href = '/public/user.html';
            } catch (error) {
                console.error(error);
                alert('결제 처리 중 문제가 발생했습니다.');
            }
        };

        loadOrderSummary();
    </script>
</body>

</html>